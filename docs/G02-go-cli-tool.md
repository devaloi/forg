# G02: forg — Smart File Organizer CLI

**Catalog ID:** G02 | **Size:** S | **Language:** Go
**Repo name:** `forg`
**One-liner:** A fast, configurable file organizer CLI that sorts files into directories based on rules you define in YAML.

---

## Why This Stands Out

- Demonstrates **Cobra + Viper** (industry-standard Go CLI stack)
- Shows **clean architecture**: rules engine is decoupled from file operations
- **Dry-run mode** and **undo log** show production-mindedness
- Configurable via YAML — not hardcoded logic
- Thorough **table-driven tests** with a temp filesystem
- Single binary, zero dependencies at runtime

---

## Architecture

```
forg/
├── cmd/
│   ├── root.go           # Cobra root command, global flags
│   ├── run.go            # `forg run` — execute organizing rules
│   ├── init.go           # `forg init` — generate sample config
│   ├── undo.go           # `forg undo` — reverse last run
│   └── preview.go        # `forg preview` — dry-run, show plan
├── internal/
│   ├── config/
│   │   └── config.go     # YAML config parsing + validation
│   ├── rules/
│   │   ├── engine.go     # Rule matching engine
│   │   ├── rule.go       # Rule types: extension, pattern, size, age
│   │   └── engine_test.go
│   ├── organizer/
│   │   ├── organizer.go  # Orchestrates scan → match → move
│   │   ├── plan.go       # Build a move plan (list of operations)
│   │   ├── executor.go   # Execute the plan (move/copy files)
│   │   ├── undo.go       # Read/write undo log, reverse moves
│   │   └── organizer_test.go
│   └── scanner/
│       ├── scanner.go    # Walk directories, collect file metadata
│       └── scanner_test.go
├── testdata/              # Sample configs and file fixtures for tests
├── .forg.yaml             # Example config (also generated by `forg init`)
├── main.go
├── go.mod
├── go.sum
├── Makefile
├── .gitignore
├── .golangci.yml
├── LICENSE
└── README.md
```

---

## Config Format (.forg.yaml)

```yaml
# .forg.yaml — forg configuration
source: ~/Downloads
conflict: skip          # skip | rename | overwrite

rules:
  - name: Images
    match:
      extensions: [.jpg, .jpeg, .png, .gif, .webp, .svg]
    destination: ~/Pictures/Downloads

  - name: Documents
    match:
      extensions: [.pdf, .doc, .docx, .xls, .xlsx, .csv]
    destination: ~/Documents/Downloads

  - name: Archives
    match:
      extensions: [.zip, .tar, .gz, .rar, .7z]
    destination: ~/Archives

  - name: Large Files
    match:
      min_size: 100MB
    destination: ~/LargeFiles

  - name: Old Screenshots
    match:
      pattern: "Screenshot*"
      older_than: 30d
    destination: ~/Pictures/Old Screenshots
```

---

## Commands

| Command | Description |
|---------|-------------|
| `forg run` | Execute rules, move files, write undo log |
| `forg run --dry-run` | Show what would happen without moving anything |
| `forg preview` | Alias for `run --dry-run` with formatted table output |
| `forg init` | Generate a sample `.forg.yaml` in current directory |
| `forg undo` | Reverse the most recent run using the undo log |

**Global flags:** `--config path` (default `.forg.yaml`), `--verbose`, `--quiet`

---

## Phases

### Phase 1: Scaffold & Core Logic

**1.1 — Project setup**
- `go mod init github.com/USERNAME/forg`
- Install deps: `github.com/spf13/cobra`, `github.com/spf13/viper`, `gopkg.in/yaml.v3`
- Create directory structure per architecture above
- Create `Makefile` with: `build`, `test`, `lint`, `run`, `clean`
- Create `.gitignore`: binary, .env, .DS_Store, dist/
- Create `.golangci.yml` with standard linters enabled

**1.2 — Config parsing**
- Parse `.forg.yaml` into typed Go structs
- Validate: source dir exists, rules have name + match + destination, size strings parse correctly
- Return clear error messages on invalid config

**1.3 — Scanner**
- Walk `source` directory (non-recursive by default, `--recursive` flag)
- Collect: path, name, extension, size, mod time
- Skip hidden files by default (`--include-hidden` flag)
- Return `[]FileInfo` slice

**1.4 — Rules engine**
- Each rule has matchers: `extensions`, `pattern` (glob), `min_size`, `max_size`, `older_than`, `newer_than`
- Multiple matchers in one rule = AND logic (all must match)
- First matching rule wins (rules evaluated in order)
- `engine.Match(file) → *Rule` returns the first matching rule or nil

**1.5 — Organizer (plan + execute)**
- `BuildPlan(files, rules) → []MoveOp` — pair each file with its destination
- `Execute(plan, dryRun) → Report` — perform moves, handle conflicts, return summary
- Conflict strategies: `skip` (log and continue), `rename` (append `-1`, `-2`), `overwrite`
- Write undo log to `~/.forg/undo.json` after successful run

### Phase 2: Commands & UX

**2.1 — Cobra commands**
- `root.go`: banner, version flag, global config flag
- `run.go`: load config → scan → match → plan → execute. Respect `--dry-run`.
- `init.go`: write sample config to `.forg.yaml` (don't overwrite if exists)
- `preview.go`: same as `run --dry-run` but formatted as a table
- `undo.go`: read `~/.forg/undo.json`, reverse all moves, delete log

**2.2 — Output formatting**
- `preview`/`dry-run`: table with columns: File | Rule | Destination
- `run`: summary line — "Moved 14 files (3 skipped, 1 conflict)"
- `--verbose`: log each individual move
- Color output using `github.com/fatih/color` (optional, degrade gracefully)

**2.3 — Undo log format**
```json
{
  "timestamp": "2026-02-17T10:30:00Z",
  "config": ".forg.yaml",
  "operations": [
    {"from": "/old/path/file.pdf", "to": "/new/path/file.pdf"},
    ...
  ]
}
```

### Phase 3: Comprehensive Tests

**3.1 — Unit tests**
- `config_test.go`: valid config, missing fields, invalid sizes, bad YAML
- `engine_test.go`: table-driven — each rule type, AND logic, first-match-wins, no match
- `scanner_test.go`: temp dir with various files, hidden files, empty dir
- `organizer_test.go`: plan building, conflict handling (all 3 strategies), undo

**3.2 — Integration test**
- Create temp dir with mixed files + a config
- Run full pipeline: scan → match → plan → execute
- Assert files moved to correct destinations
- Run undo → assert files back to original locations

**3.3 — Edge cases**
- Empty source directory
- No matching rules (files untouched)
- Destination doesn't exist (auto-create)
- File already at destination
- Config file doesn't exist
- Permission denied on move

### Phase 4: Refactor for Elegance

- Review all code for DRY violations — extract shared patterns
- Ensure all exported functions have doc comments
- Use interfaces where it helps testability (e.g., `FileSystem` interface for mocking)
- Make rule matchers implement a `Matcher` interface so new match types can be added easily
- Ensure error messages are user-friendly, not Go stack traces
- Run `golangci-lint run` and fix everything

### Phase 5: Documentation & Polish

**5.1 — README.md**
```
# forg — Smart File Organizer

[badges: Go version, CI status, License]

One-line description.

## Install
  go install / binary download

## Quick Start
  forg init → edit .forg.yaml → forg preview → forg run

## Configuration Reference
  Full YAML reference with all match types

## Commands
  Table of all commands

## Examples
  2-3 real-world config examples

## Development
  make build, make test, make lint

## License
  MIT
```

**5.2 — Final checks**
- Run full posting checklist from `github-portfolio-checklist.md`
- `go build` produces single binary
- `go test ./...` all green
- `golangci-lint run` clean
- No hardcoded paths, no personal data
- Commit history: conventional commits, logical progression

---

## Tech Stack

| Component | Choice |
|-----------|--------|
| CLI framework | cobra |
| Config | viper + yaml.v3 |
| Testing | stdlib testing + testify/assert |
| Linting | golangci-lint |
| Build | Makefile + go build |

---

## Commit Plan

1. `feat: scaffold project structure and Makefile`
2. `feat: add config parsing with validation`
3. `feat: add directory scanner`
4. `feat: add rules engine with matcher types`
5. `feat: add organizer (plan, execute, conflicts)`
6. `feat: add cobra commands (run, init, preview, undo)`
7. `test: add comprehensive unit tests`
8. `test: add integration test for full pipeline`
9. `refactor: extract Matcher interface, improve DRY`
10. `docs: add README with examples and config reference`
11. `chore: final lint pass and cleanup`
